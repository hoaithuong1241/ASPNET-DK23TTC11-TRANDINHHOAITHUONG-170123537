@model IEnumerable<JobPortal.Models.JobDetails>

@{
    ViewBag.Title = "Jobs";
    Layout = "~/Views/Shared/MainLayout.cshtml";
    var categories = Model.Select(job => new { CategoryName = job.CategoryName, CategoryId = job.CategoryID }).Distinct().ToList();
}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
    body {
        font-family: 'Poppins', sans-serif;
        background-color: #f8f9fa;
    }
    .search-card {
        background: white;
        border-radius: 15px;
        box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        padding: 25px;
        margin-bottom: 20px;
    }
    .filter-category {
        display: inline-block;
        padding: 8px 15px;
        margin: 5px;
        border-radius: 20px;
        background-color: #f0f2f5;
        color: #4a5568;
        text-decoration: none;
        transition: all 0.3s ease;
    }
    .filter-category:hover {
        background-color: #3498db;
        color: white;
        transform: translateY(-2px);
    }
    .job-card {
        background: white;
        border-radius: 15px;
        box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        padding: 20px;
        margin-bottom: 20px;
        transition: transform 0.3s ease;
    }
    .job-card:hover {
        transform: translateY(-5px);
    }
    .company-logo {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .job-title {
        color: #2d3748;
        font-weight: 600;
        margin-bottom: 15px;
    }
    .job-info {
        color: #718096;
        font-size: 0.95rem;
        margin-bottom: 8px;
    }
    .btn-details {
        padding: 8px 20px;
        border-radius: 25px;
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        border: none;
        transition: all 0.3s ease;
    }
    .btn-details:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        color: white;
    }
    .search-input {
        border-radius: 25px;
        padding: 12px 20px;
        border: 2px solid #e2e8f0;
    }
    .search-btn {
        border-radius: 25px;
        padding: 10px 25px;
        background: linear-gradient(135deg, #3498db, #2980b9);
        border: none;
        color: white;
    }
</style>

<div class="container-fluid py-4">
    <div class="row">
        <div class="col-md-3">
            <div class="search-card">
                <h4 class="mb-4 fw-bold">Find Your Dream Job</h4>
                <div class="input-group mb-4">
                    <input type="text" id="searchString" placeholder="Search jobs..." class="form-control search-input" />
                    <button id="searchButton" class="btn search-btn ms-2">
                        <i class="fas fa-search"></i> Search
                    </button>
                </div>

                <h5 class="mb-3 fw-bold">Categories</h5>
                <div class="categories-container">
                    @foreach (var cat in categories)
                    {
                        <a href="@Url.Action("Jobs", "Home", new { search = cat.CategoryName })" class="filter-category">
                            <i class="fas fa-tag me-2"></i>@cat.CategoryName
                        </a>
                    }
                </div>
            </div>
        </div>
        
        <div class="col-md-9">
            @if (!Model.Any())
            {
                <div class="text-center py-5">
                    <i class="fas fa-search fa-3x text-muted mb-3"></i>
                    <h4>No jobs found</h4>
                    <p class="text-muted">Try adjusting your search criteria</p>
                </div>
            }
            else
            {
                foreach (var item in Model.OrderByDescending(job => job.JobID))
                {
                    if (item.IsPublished && item.ApplicationDeadline >= DateTime.Now)
                    {
                        <div class="job-card">
                            <div class="row align-items-center">
                                <div class="col-md-2 text-center">
                                    <img alt="@item.CompanyName" src="data:jpg/png;base64,@Convert.ToBase64String(item.CompanyLogo)" class="company-logo" />
                                </div>
                                <div class="col-md-8">
                                    <h4 class="job-title">@item.JobTitle</h4>
                                    <div class="job-info">
                                        <p class="mb-2"><i class="fas fa-building me-2"></i>@item.CompanyName</p>
                                        <p class="mb-2"><i class="fas fa-briefcase me-2"></i>@item.CategoryName <i class="fas fa-map-marker-alt ms-3 me-2"></i>@item.Location</p>
                                        <p class="mb-0"><i class="fas fa-money-bill-wave me-2"></i>@item.Salary</p>
                                    </div>
                                </div>
                                <div class="col-md-2 text-end">
                                    @Html.ActionLink("View Details", "Login", null, new { @class = "btn btn-details" })
                                </div>
                            </div>
                        </div>
                    }
                }
            }
        </div>
    </div>
</div>

<script src="~/Scripts/jquery-3.7.1.min.js"></script>
<script>
    $(document).ready(function () {
        $("#searchButton").click(function () {
            var searchString = $("#searchString").val();
            var url = "@Url.Action("Jobs", "Home")?search=" + encodeURIComponent(searchString);
            window.location.href = url;
        });
        
        $("#searchString").on('keypress', function (e) {
            if (e.which == 13) {
                $("#searchButton").click();
            }
        });
    });
</script>